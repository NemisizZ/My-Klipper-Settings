#=============================================================================
# Include other Configs (Use FOLDER/*.cfg as wildcard to include all files)
#=============================================================================
[include mainsail.cfg]
[include EXTRA/GCODE_MACROS/*.cfg] #Loads in MACROS from Extra/Gcode_Macros folder
[include EXTRA/board.temp.cfg]
#[include EXTRA/led-rgb.cfg]
#[include EXTRA/input.shaper.cfg]
#[include EXTRA/fan.control.cfg]

#=============================================================================
# MCU Connection
#=============================================================================
[mcu] # ls /dev/serial/by-id/*
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0 
restart_method: command

#=============================================================================
[virtual_sdcard]
path: /home/biqu/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

#=============================================================================
# PRINTER LIMIT SETTING
#=============================================================================
[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_accel_to_decel: 1500
max_z_velocity: 5
max_z_accel: 200
square_corner_velocity: 5

#=============================================================================
# X STEPPER - Toolhead / Extruder carriage.
#=============================================================================
[stepper_x]
step_pin: PC2
dir_pin: PB9
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: !PA5
position_endstop: -9
position_max: 310
position_min: -10
homing_speed: 50

#=============================================================================
# Y STEPPER - Bed carriage.
#=============================================================================
[stepper_y]
step_pin: PB8
dir_pin: PB7
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: !PA6
position_endstop: -4
position_max: 299
position_min: -5
homing_speed: 50

#=============================================================================
# Z STEPPER - Gantry
#=============================================================================
[stepper_z]
step_pin: PB6
dir_pin: !PB5
enable_pin: !PC3
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
#position_endstop: 0.0 # this needs to be commented out when using BLTouch and BDSensor.
position_max: 300
position_min: -2.0
homing_speed: 4
second_homing_speed: 0.8

#=============================================================================
# EXTRUDER 
#=============================================================================
[extruder]
step_pin: PB4
dir_pin: PB3
enable_pin: !PC3
microsteps: 16
gear_ratio: 42:12
rotation_distance: 26.359
nozzle_diameter: 0.400
pressure_advance: 0.0930
pressure_advance_smooth_time: 0.040
filament_diameter: 1.750
heater_pin: PA1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC5
control: pid
pid_Kp: 23.561
pid_Ki: 1.208
pid_Kd: 114.859
min_temp: 0
max_temp: 260

#=============================================================================
# BDSensor - https://github.com/markniu/Bed_Distance_sensor
#=============================================================================
[BDsensor]
sda_pin: ^PC14
scl_pin: PC13
delay: 20
z_offset: 0 # LEAVE THIS AT 0 / z_offset must be set to 0. 
z_adjust: -0.230 # z axis adjustment, replace the z_offset function. within -0.300 to 0.300mm
x_offset: -35
y_offset: -45
no_stop_probe: # this enables nonestop probing. 
position_endstop: 0.8
speed: 0.8

#=============================================================================
# Force Move - Required for BDsensor / Enables SET_KINEMATIC_POSITION
#=============================================================================
[force_move] 
enable_force_move: true # 'true' enables SET_KINEMATIC_POSITION

#=============================================================================
# AUTO BED MESH
#=============================================================================
[bed_mesh]
speed: 200
mesh_min: 10, 10
mesh_max: 275, 254
probe_count: 25,25
horizontal_move_z: 0.9 # 0.7 ~ 1.0mm is recommended
mesh_pps: 2,2
fade_start: 1
fade_end: 10
fade_target: 0
algorithm: bicubic

#=============================================================================
# HEATER BED
#=============================================================================
[heater_bed]
heater_pin: PA7
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
control: pid
pid_Kp: 71.867
pid_Ki: 1.536
pid_Kd: 840.843
min_temp: 0
max_temp: 100

#=============================================================================
# FAN CONTROL
#=============================================================================
[heater_fan hotend_fan]
pin: PC0

#=====

[fan]
pin: PA0

#=============================================================================
# SENSORS
#=============================================================================
[filament_switch_sensor e0_sensor]
switch_pin: !PC15
pause_on_runout: true
runout_gcode: PAUSE

#=============================================================================
# 
#=============================================================================
[safe_z_home]
home_xy_position: 150, 150
speed: 50
z_hop: 10
z_hop_speed: 5

#=====

[pause_resume]
recover_velocity: 25

#=============================================================================
# 
#=============================================================================

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.190000, 0.170000, 0.150000, 0.130000, 0.125000, 0.100000, 0.055000, 0.035000, 0.020000, 0.015000, 0.000000, -0.030000, -0.030000, -0.015000, 0.010000, 0.020000, 0.030000, 0.040000, 0.105000, 0.145000, 0.170000, 0.180000, 0.215000, 0.225000, 0.240000
#*# 	  0.200000, 0.145000, 0.135000, 0.125000, 0.115000, 0.090000, 0.040000, 0.035000, 0.015000, 0.010000, 0.005000, -0.040000, -0.035000, -0.020000, -0.005000, 0.015000, 0.020000, 0.030000, 0.105000, 0.125000, 0.150000, 0.155000, 0.185000, 0.210000, 0.215000
#*# 	  0.150000, 0.135000, 0.115000, 0.110000, 0.100000, 0.075000, 0.030000, 0.015000, 0.010000, 0.000000, -0.020000, -0.050000, -0.045000, -0.035000, -0.010000, 0.000000, 0.010000, 0.020000, 0.080000, 0.115000, 0.145000, 0.160000, 0.195000, 0.205000, 0.225000
#*# 	  0.165000, 0.130000, 0.120000, 0.110000, 0.100000, 0.080000, 0.025000, 0.020000, 0.000000, 0.000000, -0.010000, -0.055000, -0.045000, -0.035000, -0.020000, 0.005000, 0.010000, 0.025000, 0.085000, 0.115000, 0.135000, 0.150000, 0.165000, 0.170000, 0.190000
#*# 	  0.145000, 0.120000, 0.120000, 0.115000, 0.105000, 0.075000, 0.035000, 0.025000, 0.010000, 0.000000, -0.015000, -0.040000, -0.045000, -0.035000, -0.015000, 0.000000, 0.000000, 0.015000, 0.075000, 0.110000, 0.145000, 0.140000, 0.170000, 0.190000, 0.195000
#*# 	  0.155000, 0.115000, 0.125000, 0.110000, 0.105000, 0.070000, 0.030000, 0.025000, 0.000000, 0.000000, -0.010000, -0.060000, -0.050000, -0.035000, -0.025000, -0.010000, 0.000000, 0.010000, 0.070000, 0.100000, 0.125000, 0.125000, 0.155000, 0.170000, 0.180000
#*# 	  0.150000, 0.125000, 0.120000, 0.115000, 0.100000, 0.065000, 0.030000, 0.020000, 0.010000, -0.005000, -0.015000, -0.055000, -0.050000, -0.040000, -0.030000, -0.010000, -0.020000, 0.005000, 0.060000, 0.085000, 0.110000, 0.120000, 0.140000, 0.160000, 0.180000
#*# 	  0.165000, 0.130000, 0.125000, 0.115000, 0.105000, 0.070000, 0.035000, 0.025000, 0.005000, 0.000000, -0.010000, -0.065000, -0.050000, -0.040000, -0.030000, -0.015000, -0.015000, 0.005000, 0.045000, 0.085000, 0.110000, 0.110000, 0.135000, 0.150000, 0.170000
#*# 	  0.165000, 0.140000, 0.125000, 0.115000, 0.115000, 0.070000, 0.035000, 0.025000, 0.010000, 0.000000, -0.015000, -0.050000, -0.050000, -0.045000, -0.030000, -0.015000, -0.020000, 0.000000, 0.035000, 0.075000, 0.100000, 0.105000, 0.125000, 0.140000, 0.165000
#*# 	  0.170000, 0.130000, 0.125000, 0.115000, 0.105000, 0.070000, 0.035000, 0.025000, 0.010000, 0.005000, -0.010000, -0.055000, -0.050000, -0.040000, -0.030000, -0.010000, -0.015000, 0.000000, 0.040000, 0.070000, 0.105000, 0.100000, 0.125000, 0.140000, 0.165000
#*# 	  0.165000, 0.140000, 0.135000, 0.120000, 0.115000, 0.090000, 0.055000, 0.025000, 0.015000, 0.010000, -0.010000, -0.060000, -0.040000, -0.035000, -0.025000, -0.010000, -0.010000, 0.000000, 0.045000, 0.085000, 0.105000, 0.110000, 0.130000, 0.145000, 0.170000
#*# 	  0.185000, 0.140000, 0.130000, 0.130000, 0.115000, 0.100000, 0.045000, 0.030000, 0.015000, 0.010000, 0.005000, -0.040000, -0.040000, -0.025000, -0.020000, -0.010000, -0.005000, 0.005000, 0.050000, 0.080000, 0.110000, 0.115000, 0.135000, 0.155000, 0.170000
#*# 	  0.185000, 0.150000, 0.150000, 0.135000, 0.125000, 0.095000, 0.050000, 0.035000, 0.025000, 0.015000, 0.000000, -0.035000, -0.035000, -0.030000, -0.015000, 0.000000, 0.005000, 0.015000, 0.055000, 0.095000, 0.110000, 0.115000, 0.135000, 0.170000, 0.180000
#*# 	  0.205000, 0.165000, 0.150000, 0.140000, 0.130000, 0.110000, 0.055000, 0.045000, 0.025000, 0.020000, 0.010000, -0.020000, -0.025000, -0.020000, -0.015000, 0.000000, 0.010000, 0.020000, 0.055000, 0.090000, 0.120000, 0.125000, 0.155000, 0.165000, 0.180000
#*# 	  0.195000, 0.180000, 0.160000, 0.140000, 0.130000, 0.105000, 0.055000, 0.045000, 0.030000, 0.015000, 0.000000, -0.035000, -0.030000, -0.020000, -0.010000, 0.005000, 0.010000, 0.020000, 0.070000, 0.085000, 0.125000, 0.120000, 0.140000, 0.170000, 0.185000
#*# 	  0.215000, 0.180000, 0.160000, 0.145000, 0.135000, 0.110000, 0.070000, 0.045000, 0.030000, 0.020000, 0.010000, -0.030000, -0.020000, -0.015000, -0.010000, 0.010000, 0.020000, 0.025000, 0.070000, 0.105000, 0.130000, 0.130000, 0.160000, 0.175000, 0.185000
#*# 	  0.220000, 0.195000, 0.160000, 0.145000, 0.140000, 0.115000, 0.070000, 0.050000, 0.035000, 0.020000, 0.010000, -0.010000, -0.025000, -0.015000, 0.005000, 0.020000, 0.015000, 0.025000, 0.080000, 0.105000, 0.130000, 0.140000, 0.170000, 0.190000, 0.185000
#*# 	  0.230000, 0.180000, 0.180000, 0.165000, 0.140000, 0.120000, 0.080000, 0.060000, 0.040000, 0.025000, 0.020000, -0.015000, -0.020000, -0.005000, 0.015000, 0.025000, 0.025000, 0.035000, 0.090000, 0.125000, 0.155000, 0.150000, 0.180000, 0.200000, 0.215000
#*# 	  0.245000, 0.205000, 0.185000, 0.170000, 0.155000, 0.130000, 0.085000, 0.070000, 0.050000, 0.035000, 0.030000, -0.010000, -0.005000, 0.005000, 0.030000, 0.040000, 0.035000, 0.050000, 0.110000, 0.135000, 0.165000, 0.175000, 0.210000, 0.220000, 0.235000
#*# 	  0.240000, 0.200000, 0.210000, 0.185000, 0.160000, 0.130000, 0.105000, 0.085000, 0.060000, 0.055000, 0.045000, 0.010000, 0.015000, 0.030000, 0.045000, 0.050000, 0.055000, 0.075000, 0.125000, 0.140000, 0.190000, 0.205000, 0.220000, 0.230000, 0.265000
#*# 	  0.260000, 0.220000, 0.205000, 0.195000, 0.170000, 0.145000, 0.110000, 0.095000, 0.075000, 0.060000, 0.060000, 0.035000, 0.085000, 0.085000, 0.080000, 0.080000, 0.075000, 0.105000, 0.155000, 0.185000, 0.210000, 0.215000, 0.240000, 0.250000, 0.275000
#*# 	  0.205000, 0.200000, 0.205000, 0.200000, 0.190000, 0.140000, 0.120000, 0.110000, 0.095000, 0.085000, 0.070000, 0.040000, 0.050000, 0.060000, 0.075000, 0.100000, 0.105000, 0.120000, 0.165000, 0.200000, 0.230000, 0.240000, 0.265000, 0.275000, 0.310000
#*# 	  0.275000, 0.240000, 0.225000, 0.215000, 0.200000, 0.170000, 0.120000, 0.115000, 0.105000, 0.085000, 0.070000, 0.050000, 0.055000, 0.065000, 0.080000, 0.105000, 0.105000, 0.120000, 0.180000, 0.220000, 0.230000, 0.255000, 0.290000, 0.305000, 0.315000
#*# 	  0.300000, 0.265000, 0.225000, 0.230000, 0.200000, 0.185000, 0.125000, 0.110000, 0.105000, 0.100000, 0.080000, 0.050000, 0.060000, 0.070000, 0.090000, 0.110000, 0.110000, 0.125000, 0.190000, 0.215000, 0.260000, 0.250000, 0.305000, 0.305000, 0.345000
#*# 	  0.345000, 0.305000, 0.265000, 0.245000, 0.230000, 0.200000, 0.140000, 0.115000, 0.100000, 0.090000, 0.080000, 0.050000, 0.055000, 0.065000, 0.090000, 0.115000, 0.115000, 0.125000, 0.190000, 0.245000, 0.260000, 0.270000, 0.310000, 0.320000, 0.345000
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 274.96
#*# min_y = 10.0
#*# max_y = 253.83999999999997
